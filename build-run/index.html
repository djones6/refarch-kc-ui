



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Build and run - Container Shipment EDA User Interface</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#build-run-and-deploy-the-user-interface-component" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Container Shipment EDA User Interface" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Container Shipment EDA User Interface
            </span>
            <span class="md-header-nav__topic">
              
                Build and run
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-ui/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Container Shipment EDA User Interface" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Container Shipment EDA User Interface
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-ui/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build and run
      </label>
    
    <a href="./" title="Build and run" class="md-nav__link md-nav__link--active">
      Build and run
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ui-build" class="md-nav__link">
    UI Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-running-unit-tests" class="md-nav__link">
    UI Running unit tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-and-run-the-bff-server" class="md-nav__link">
    Build and run the BFF server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerize-all" class="md-nav__link">
    Dockerize all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-locally" class="md-nav__link">
    Run locally
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-docker-compose" class="md-nav__link">
    Using docker compose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-minikube" class="md-nav__link">
    Using Minikube
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-openshift-container-platform-ocp" class="md-nav__link">
    Deploy to OpenShift Container Platform (OCP)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-prerequisites" class="md-nav__link">
    Deployment prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-to-ocp-311" class="md-nav__link">
    Deploy to OCP 3.11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-kc/demo/readme/" title="Demonstration script" class="md-nav__link">
      Demonstration script
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ui-build" class="md-nav__link">
    UI Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-running-unit-tests" class="md-nav__link">
    UI Running unit tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-and-run-the-bff-server" class="md-nav__link">
    Build and run the BFF server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerize-all" class="md-nav__link">
    Dockerize all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-locally" class="md-nav__link">
    Run locally
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-docker-compose" class="md-nav__link">
    Using docker compose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-minikube" class="md-nav__link">
    Using Minikube
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-openshift-container-platform-ocp" class="md-nav__link">
    Deploy to OpenShift Container Platform (OCP)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-prerequisites" class="md-nav__link">
    Deployment prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-to-ocp-311" class="md-nav__link">
    Deploy to OCP 3.11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-kc-ui/edit/master/docs/build-run.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="build-run-and-deploy-the-user-interface-component">Build Run and Deploy the User Interface component</h1>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>Be sure to have cloned the root repository: <code>refarch_kc</code> as there is a dependency on the environment setting scripts (<code>refarch_kc/scripts/setenv.sh</code>).</p>
<p>The UI is using Angular so you need to get angular CLI installed, nodejs and npm.</p>
<p>Keep npm up to date with the command:</p>
<p><div class="codehilite"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="k">g</span> <span class="n">npm</span>
</pre></div>
Verify node version (we run v 12.0)</p>
<div class="codehilite"><pre><span></span><span class="n">node</span> <span class="o">-</span><span class="n">v</span>
</pre></div>

<p>To install or update Angular CLI</p>
<div class="codehilite"><pre><span></span><span class="n">cd</span><span class="w"> </span><span class="n">ui</span><span class="w"></span>
<span class="n">npm</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="nv">@angular</span><span class="o">/</span><span class="n">cli</span><span class="w"></span>
</pre></div>

<p>And install all the dependencies
<div class="codehilite"><pre><span></span><span class="n">npm</span> <span class="n">install</span>
</pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note<p>The project was started with Angular 6 and then migrated to Angular 8 with the commands:
<div class="codehilite"><pre><span></span><span class="n">ng</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="nv">@angular</span><span class="o">/</span><span class="n">cli</span><span class="w"> </span><span class="nv">@angular</span><span class="o">/</span><span class="n">core</span><span class="w"></span>
<span class="n">ng</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="nv">@angular</span><span class="o">/</span><span class="n">material</span><span class="w"></span>
</pre></div></p>
</p>
</div>
<p>The test driven development approach is done using <a href="https://mochajs.org/">mocha</a> as test runner and <a href="https://www.chaijs.com">chai</a> for assertion library and Typescript. Which means those tools were installed with the command:
<div class="codehilite"><pre><span></span>$ <span class="nv">npm</span> <span class="nv">install</span> <span class="nv">mocha</span> <span class="nv">chai</span> <span class="nv">ts</span><span class="o">-</span><span class="nv">node</span> <span class="o">--</span><span class="nv">save</span><span class="o">-</span><span class="nv">dev</span>
# <span class="nv">and</span> <span class="nv">install</span> <span class="nv">the</span> <span class="nv">supporting</span> <span class="nv">types</span> <span class="k">for</span> <span class="nv">Typescript</span>
# <span class="nv">npm</span> <span class="nv">install</span> @<span class="nv">types</span><span class="o">/</span><span class="nv">chai</span> @<span class="nv">types</span><span class="o">/</span><span class="nv">mocha</span> <span class="o">--</span><span class="nv">save</span><span class="o">-</span><span class="nv">dev</span>
</pre></div></p>
<h2 id="build">Build</h2>
<h3 id="ui-build">UI Build</h3>
<p>While doing development, you can build the UI first, by being under the <code>ui</code> folder and run:</p>
<div class="codehilite"><pre><span></span><span class="n">ng</span> <span class="n">build</span>
</pre></div>

<p>You should get a trace like:
<div class="codehilite"><pre><span></span><span class="n">chunk</span><span class="w"> </span><span class="err">{</span><span class="n">main</span><span class="err">}</span><span class="w"> </span><span class="n">main</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="w"> </span><span class="mi">156</span><span class="w"> </span><span class="n">kB</span><span class="w"> </span><span class="o">[</span><span class="n">initial</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rendered</span><span class="o">]</span><span class="w"></span>
<span class="n">chunk</span><span class="w"> </span><span class="err">{</span><span class="n">polyfills</span><span class="err">}</span><span class="w"> </span><span class="n">polyfills</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">,</span><span class="w"> </span><span class="n">polyfills</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">polyfills</span><span class="p">)</span><span class="w"> </span><span class="mi">438</span><span class="w"> </span><span class="n">kB</span><span class="w"> </span><span class="o">[</span><span class="n">initial</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rendered</span><span class="o">]</span><span class="w"></span>
<span class="n">chunk</span><span class="w"> </span><span class="err">{</span><span class="n">runtime</span><span class="err">}</span><span class="w"> </span><span class="n">runtime</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span><span class="w"> </span><span class="mf">6.08</span><span class="w"> </span><span class="n">kB</span><span class="w"> </span><span class="o">[</span><span class="n">entry</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rendered</span><span class="o">]</span><span class="w"></span>
<span class="n">chunk</span><span class="w"> </span><span class="err">{</span><span class="n">styles</span><span class="err">}</span><span class="w"> </span><span class="n">styles</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">,</span><span class="w"> </span><span class="n">styles</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">styles</span><span class="p">)</span><span class="w"> </span><span class="mi">392</span><span class="w"> </span><span class="n">kB</span><span class="w"> </span><span class="o">[</span><span class="n">initial</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rendered</span><span class="o">]</span><span class="w"></span>
<span class="n">chunk</span><span class="w"> </span><span class="err">{</span><span class="n">vendor</span><span class="err">}</span><span class="w"> </span><span class="n">vendor</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">,</span><span class="w"> </span><span class="n">vendor</span><span class="o">-</span><span class="n">es2015</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">vendor</span><span class="p">)</span><span class="w"> </span><span class="mf">5.81</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="o">[</span><span class="n">initial</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rendered</span><span class="o">]</span><span class="w"></span>
</pre></div></p>
<p>The build artifacts will be stored in the <code>dist/</code> directory. Use the <code>--prod</code> flag for a production build so the javascripts will be smaller.</p>
<p>It is possible to test the User interface without the nodejs backend, by using</p>
<div class="codehilite"><pre><span></span><span class="n">ng</span> <span class="n">serve</span>
</pre></div>

<p>Navigate to http://localhost:4200/. The app will automatically reload if you change any of the UI source files.</p>
<p>You may encounter some issues as there are dependencies on the backend nodejs for some APIs and data.</p>
<h3 id="ui-running-unit-tests">UI Running unit tests</h3>
<p>Run <code>ng test</code> to execute the unit tests via <a href="https://karma-runner.github.io">Karma</a>.</p>
<h3 id="build-and-run-the-bff-server">Build and run the BFF server</h3>
<p>Run the command below:
<div class="codehilite"><pre><span></span><span class="n">npm</span> <span class="n">serve</span>
</pre></div></p>
<p>All those commands are executed when developing the server or ui parts. But when we need to deploy the user interface with the other components of the solution we first need to build a docker image and then be sure the other services are deployed...</p>
<h3 id="dockerize-all">Dockerize all</h3>
<p>Build UI and server in one command: (this is what a CI/CD pipeline will use).</p>
<div class="codehilite"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">buildDocker</span><span class="p">.</span><span class="n">sh</span>
</pre></div>

<p>This will build a docker image, named: <code>ibmcase/kcontainer-ui:latest</code> for local execution using docker-compose.</p>
<p>If you run on minikube locally use:</p>
<div class="codehilite"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">buildDocker</span><span class="p">.</span><span class="n">sh</span> <span class="n">MINIKUBE</span>
</pre></div>

<h2 id="run-locally">Run locally</h2>
<p>To be able to run the UI and server locally, you need to have at least the following kafka, zookeeper, order command, order query and fleet simulator microservices up and running.</p>
<p>As introduced before we have two options to run the solution, Minikube or docker-compose.</p>
<h3 id="using-docker-compose">Using docker compose</h3>
<p>We recommend to read <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/local/">this chapter</a></p>
<ul>
<li>If not done already start Kafka and zookeeper using the docker compose file in the root project:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="p">..</span><span class="o">/</span><span class="n">refarch</span><span class="o">-</span><span class="n">kc</span><span class="o">/</span><span class="n">docker</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">backbone</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span> <span class="n">up</span>
</pre></div>

<ul>
<li>
<p>Start the Fleet simulator.  For the fleet simulator <a href="https://github.com/ibm-cloud-architecture/refarch-kc-ms/tree/master/fleet-ms#run">see instructions here</a> to run the simulator locally.</p>
</li>
<li>
<p>Run the following command:
<div class="codehilite"><pre><span></span><span class="o">`</span><span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">buildLocal</span><span class="p">.</span><span class="n">sh</span><span class="o">`</span>
</pre></div></p>
</li>
<li>
<p>Start the UI and BFF locally with <code>./scripts/run.sh</code> or with a docker <code>./scripts/runDocker.sh</code>.</p>
</li>
<li>
<p>Use your web browser at http://localhost:31010</p>
</li>
</ul>
<h3 id="using-minikube">Using Minikube</h3>
<p>See the instruction in <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/minikube/">this article</a> for deploying all the components.</p>
<p>Use the <code>scripts\deployHelm MINIKUBE latest</code> command to use Helm to deploy the user interface release.</p>
<ul>
<li>Use your web browser at http://localhost:31010</li>
</ul>
<h2 id="deploy-to-openshift-container-platform-ocp">Deploy to OpenShift Container Platform (OCP)</h2>
<h3 id="deployment-prerequisites">Deployment prerequisites</h3>
<p>Regardless of specific deployment targets (OCP, IKS, k8s), the following prerequisite Kubernetes artifacts need to be created to support the deployments of application components.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.</p>
<ol>
<li>Create <code>kafka-brokers</code> ConfigMap</li>
<li>Command: <code>kubectl create configmap kafka-brokers --from-literal=brokers='&lt;replace with comma-separated list of brokers&gt;' -n &lt;namespace&gt;</code></li>
<li>Example: <code>kubectl create configmap kafka-brokers --from-literal=brokers='broker-3-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-2-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-1-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-5-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-0-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-4-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093' -n eda-refarch</code></li>
<li>Create optional <code>eventstreams-apikey</code> Secret, if you are using Event Streams as your Kafka broker provider</li>
<li>Command: <code>kubectl create secret generic eventstreams-apikey --from-literal=binding='&lt;replace with api key&gt;' -n &lt;namespace&gt;</code></li>
<li>Example: <code>kubectl create secret generic eventstreams-apikey --from-literal=binding='z...12345...notanactualkey...67890...a' -n eda-refarch</code></li>
</ol>
<h3 id="deploy-to-ocp-311">Deploy to OCP 3.11</h3>
<p><strong>Cross-component deployment prerequisites:</strong> <em>(needs to be done once per unique deployment of the entire application)</em>
1. If desired, create a non-default Service Account for usage of deploying and running the K Container reference implementation.  This will become more important in future iterations, so it's best to start small:
  - Command: <code>oc create serviceaccount -n &lt;target-namespace&gt; kcontainer-runtime</code>
  - Example: <code>oc create serviceaccount -n eda-refarch kcontainer-runtime</code>
2. The target Service Account needs to be allowed to run containers as <code>anyuid</code> for the time being:
  - Command: <code>oc adm policy add-scc-to-user anyuid -z &lt;service-account-name&gt; -n &lt;target-namespace&gt;</code>
  - Example: <code>oc adm policy add-scc-to-user anyuid -z kcontainer-runtime -n eda-refarch</code>
  - NOTE: This requires <code>cluster-admin</code> level privileges.</p>
<p><strong>Perform the following for the <code>kc-ui</code> microservices:</strong>
1. Build and push Docker images
  1. Create a Jenkins project, pointing to the remote GitHub repository for the KContainer UI Microservice, creating the necessary parameters.  Refer to the individual microservice's <code>Jenkinsfile.NoKubernetesPlugin</code> for appropriate parameter values.
    - Create a String parameter named <code>REGISTRY</code> to determine a remote registry that is accessible from your cluster
    - Create a String parameter named <code>REGISTRY_NAMESPACE</code> to describe the registry namespace to push image into
    - Create a String parameter named <code>IMAGE_NAME</code> which should be self-expalantory
    - Create a String parameter named <code>CONTEXT_DIR</code> to determine the correct working directory to work from inside the source code, with respect to the root of the repository
    - Create a String parameter named <code>DOCKERFILE</code> to determine the desired Dockerfile to use to build the Docker image.  This is determined with respect to the <code>CONTEXT_DIR</code> parameter.
    - Create a Credentials parameter named <code>REGISTRY_CREDENTIALS</code> and assign the necessary credentials to allow Jenkins to push the image to the remote repository
  2. Manually build the Docker image and push it to a registry that is accessible from your cluster (Docker Hub, IBM Cloud Container Registry, manually deployed Quay instance):
    - <code>docker build -t &lt;private-registry&gt;/&lt;image-namespace&gt;/kcontainer-ui:latest .</code>
    - <code>docker login &lt;private-registry&gt;</code>
    - <code>docker push &lt;private-registry&gt;/&lt;image-namespace&gt;/kcontainer-ui:latest</code>
3. Generate application YAMLs via <code>helm template</code>:
  - Parameters:
    - <code>--set image.repository=&lt;private-registry&gt;/&lt;image-namespace&gt;/&lt;image-repository&gt;</code>
    - <code>--set image.tag=latest</code>
    - <code>--set image.pullSecret=&lt;private-registry-pullsecret&gt;</code> (only required if pulling from an external private registry)
    - <code>--set image.pullPolicy=Always</code>
    - <code>--set eventstreams.env=ICP</code>
    - <code>--set eventstreams.brokersConfigMap=&lt;kafka brokers ConfigMap name&gt;</code>
    - <code>--set serviceAccountName=&lt;service-account-name&gt;</code>
    - <code>--namespace &lt;target-namespace&gt;</code>
    - <code>--output-dir &lt;local-template-directory&gt;</code>
  - Example: <code>helm template --set image.repository=rhos-quay.internal-network.local/browncompute/kc-ui --set image.pullPolicy=Always --set eventstreams.env=ICP --set eventstreams.brokersConfigMap=kafka-brokers --set serviceAccountName=kcontainer-runtime --output-dir templ --namespace eda-refarch chart/kc-ui/</code>
4. Deploy application using <code>oc apply</code>:
  - <code>oc apply -f templ/kc-ui/templates</code></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>